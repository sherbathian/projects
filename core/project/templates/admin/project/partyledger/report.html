{% extends "admin/base_site.html" %}
{% block content %}
<h1>Party Ledger - Paid by / Received by</h1>

<form method="get" style="margin-bottom:12px;">
    <label for="year">Year:</label>
    <select name="year" id="year" onchange="this.form.submit()">
        <option value="any" {% if selected_year == 'any' %}selected{% endif %}>Any</option>
        {% for y in years %}
            <option value="{{ y }}" {% if selected_year == y|stringformat:"s" %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
    </select>

    <label for="start_date">Start date:</label>
    <input type="date" id="start_date" name="start_date" value="{{ start_date }}" onchange="this.form.submit()">

    <label for="end_date">End date:</label>
    <input type="date" id="end_date" name="end_date" value="{{ end_date }}" onchange="this.form.submit()">
</form>

<div style="margin-bottom:8px;">
    <button id="exportPdf" type="button">Export PDF</button>
</div>

<table class="results">
    <thead>
        <tr>
            <th>Paid by</th>
            <th>Received by</th>
            <th style="text-align:right;">Total Amount</th>
        </tr>
    </thead>
    <tbody id="ledgerBody"></tbody>
</table>

<script>
const rows = {{ rows_json|safe }};

(function populateTable(){
    const tbody = document.getElementById('ledgerBody');
    tbody.innerHTML = '';
    rows.forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.paid_by}</td><td>${r.received_by}</td><td style="text-align:right;">${(r.amount||0).toFixed(2)}</td>`;
        tbody.appendChild(tr);
    });
})();
document.getElementById('exportPdf').addEventListener('click', function(){
    const base = window.location.pathname.endsWith('/') ? window.location.pathname : window.location.pathname + '/';
    const exportUrl = base + 'export_pdf/' + window.location.search;
    window.location.href = exportUrl;
});
</script>
{% endblock %}